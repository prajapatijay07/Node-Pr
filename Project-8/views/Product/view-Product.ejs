<%- include('../header') %>

  <style>
    /* General Button Styling */
    .btn-category {
      border-radius: 20px;
      padding: 8px 18px;
      font-weight: 500;
      transition: transform 0.2s ease-in-out, opacity 0.2s ease-in-out;
    }

    .btn-category:hover {
      opacity: 0.9;
      transform: scale(1.1);
    }

    /* Card Styling - Light Theme */
    .card {
      border: 1px solid #ddd;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
      border-radius: 10px;
      overflow: hidden;
      background-color: #fff;
      transition: box-shadow 0.3s ease-in-out;
    }

    .card:hover {
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
    }

    .card-img-top {
      height: 200px;
      object-fit: cover;
      object-position: top;
      border-bottom: 1px solid #eee;
    }

    .card-body {
      color: #333;
      padding: 15px;
    }

    .card-body h5 {
      font-size: 1.2rem;
      font-weight: 600;
    }

    .card-body p {
      font-size: 0.95rem;
    }

    .card-body .btn-sm {
      border-radius: 20px;
    }

    .no-products {
      font-size: 18px;
      color: #555;
      text-align: center;
      padding: 50px;
    }

    /* Pagination Styling */
    .pagination-container {
      display: flex;
      justify-content: center;
      margin-top: 30px;
    }

    .pagination .btn {
      margin: 0 5px;
    }

    .pagination .btn-outline-primary {
      color: #007bff;
      border: 1px solid #007bff;
    }

    .pagination .btn-primary {
      background-color: #007bff;
      color: #fff;
      border: 1px solid #007bff;
    }

    .pagination .btn-outline-primary:hover {
      background-color: #007bff;
      color: #fff;
    }

    /* Search Bar */
    .search-container {
      display: flex;
      justify-content: center;
      align-items: center;
      margin: 20px 0;
    }

    .input-group .form-control {
      border-radius: 30px;
      border: 1px solid #ccc;
    }

    .input-group button {
      border-radius: 30px;
      background-color: #007bff;
      color: white;
      border: none;
    }

    .input-group button:hover {
      background-color: #0056b3;
    }
  </style>



<div class="page-wrapper">

  <!-- Breadcrumb -->
  <div class="page-breadcrumb">
    <div class="row">
      <div class="col-12 d-flex no-block align-items-center">
        <h4 class="page-title">All Products</h4>
        <div class="ml-auto text-right">
          <nav aria-label="breadcrumb">
            <ol class="breadcrumb">
              <li class="breadcrumb-item"><a href="/dashboard">Home</a></li>
              <li class="breadcrumb-item active" aria-current="page">Products</li>
            </ol>
          </nav>
        </div>
      </div>
    </div>
  </div>

  <!-- Container -->
  <div class="container-fluid">

    <div class="row">
      <div class="col-12">
        <div class="card">
          <div class="card-body">

            <!-- Title + Add Button -->
            <div class="d-flex justify-content-between align-items-center mb-3">
              <h4 class="card-title">All Product Information</h4>
              <a href="/Product/add-Product" class="btn btn-success">+ Add New Product</a>
            </div>

            <!-- Search Form -->
            <div class="search-container mb-3">
              <form method="get" action="/Product/view-Product" class="w-100">
                <div class="input-group w-100">
                  <input type="text" name="search" class="form-control" placeholder="Search products..." value="<%= search || '' %>">
                  <% if (category) { %>
                    <input type="hidden" name="category" value="<%= category %>">
                  <% } %>
                  <button class="btn btn-primary ml-2" type="submit">Search</button>
                </div>
              </form>
            </div>

            <!-- Category Filter Buttons -->
            <div class="text-center mb-4 flex-wrap d-flex justify-content-center">
              <a class="btn btn-light btn-category mx-2 mb-2 <%= !category ? 'active' : '' %>" href="/Product/view-Product?<%= search ? 'search=' + search : '' %>">All</a>
              <% let colors=['primary','danger','success','warning','info','secondary']; %>
              <% categories.forEach((cat, i) => { %>
                <a href="/Product/view-Product?category=<%= cat._id %><%= search ? '&search=' + search : '' %>"
                   class="btn btn-<%= colors[i % colors.length] %> btn-category mx-2 mb-2 <%= category == cat._id.toString() ? 'active' : '' %>">
                  <%= cat.category %>
                </a>
              <% }) %>
            </div>

            <!-- Product Cards -->
            <div class="row g-4">
              <% if (allProducts && allProducts.length > 0) { %>
                <% allProducts.forEach(product => { %>
                  <div class="col-sm-6 col-md-4 col-lg-3">
                    <div class="card h-100">
                      <img src="<%= product.productImage || '/default-image.jpg' %>" class="card-img-top" alt="<%= product.productName || 'Product Image' %>">
                      <div class="card-body d-flex flex-column">
                        <h5 class="card-title"><%= product.productName || product.title || 'Untitled' %></h5>
                        <p class="card-text"><%= product.description?.substring(0,100) + '...' || '' %></p>
                        <p class="mb-1"><strong>Price:</strong> â‚¹<%= product.price %></p>
                        <p class="mb-1"><strong>Category:</strong> <%= product.categoryId?.category || 'N/A' %></p>
                        <p class="mb-1"><strong>Subcategory:</strong> <%= product.subCategoryId?.subCategory || 'N/A' %></p>
                        <p class="mb-2"><strong>Extra Category:</strong> <%= product.extraCategoryId?.extraCategory || 'N/A' %></p>
                        <div class="mt-auto d-flex flex-wrap justify-content-between gap-1">
                          <a href="/Product/edit-Product/<%= product._id %>" class="btn btn-warning btn-sm">Edit</a>
                          <a href="/Product/single-Product/<%= product._id %>" class="btn btn-info btn-sm">View</a>
                          <a href="/Product/delete-Product/<%= product._id %>" class="btn btn-danger btn-sm" onclick="return confirm('Are you sure to delete this product?')">Delete</a>
                        </div>
                      </div>
                    </div>
                  </div>
                <% }) %>
              <% } else { %>
                <div class="col-12 text-center py-4">
                  No product records found.
                </div>
              <% } %>
            </div>

            <!-- Pagination -->
            <div class="pagination-container mt-4">
              <div class="d-flex justify-content-center pagination">
                <% if (currentPage > 1) { %>
                  <a href="/Product/view-Product?page=<%= currentPage - 1 %><%= search ? '&search=' + search : '' %><%= category ? '&category=' + category : '' %>" class="btn btn-outline-primary mx-1">Prev</a>
                <% } %>
                <% for (let i=1; i<=totalPages; i++) { %>
                  <a href="/Product/view-Product?page=<%= i %><%= search ? '&search=' + search : '' %><%= category ? '&category=' + category : '' %>" class="btn <%= i === currentPage ? 'btn-primary' : 'btn-outline-primary' %> mx-1"><%= i %></a>
                <% } %>
                <% if (currentPage < totalPages) { %>
                  <a href="/Product/view-Product?page=<%= currentPage + 1 %><%= search ? '&search=' + search : '' %><%= category ? '&category=' + category : '' %>" class="btn btn-outline-primary mx-1">Next</a>
                <% } %>
              </div>
            </div>

          </div>
        </div>
      </div>
    </div>

  </div>
</div>



  <%- include('../footer') %>